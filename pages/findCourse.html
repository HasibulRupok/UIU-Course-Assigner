<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="../CSS/findCourse.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
   
    <title>Find Course</title>
</head>

<body>
    <!-- navbar -->
    <nav class="bg-white border-gray-200 px-2 sm:px-4 py-2.5 rounded dark:bg-gray-900">
        <div class="container flex flex-wrap justify-between items-center mx-auto">
            <a href="#" class="flex items-center">
                <img src="../uiu.png" class="mr-3 h-6 sm:h-9" alt="UIU Course Assigner">
                <span class="self-center text-xl font-bold whitespace-nowrap topTogo">Course
                    Assigner<span>
            </a>

            <div class="hidden w-full md:block md:w-auto" id="navbar-default">
                <ul
                    class="flex flex-col p-4 mt-4 bg-gray-50 rounded-lg border border-gray-100 md:flex-row md:space-x-8 md:mt-0 md:text-sm md:font-medium md:border-0 md:bg-white dark:bg-gray-800 md:dark:bg-gray-900 dark:border-gray-700">
                    <li>
                        <a href="../index.php"
                            class="block py-2 pr-4 pl-3 text-white rounded block py-2 pr-4 pl-3 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-white dark:hover:text-blue-700 dark:hover:text-white md:dark:hover:bg-transparent hoverLink">Home
                            </a>
                    </li>
                    <li>
                        <a href="../newTrimester.php"
                            class="block py-2 pr-4 pl-3 text-white rounded block py-2 pr-4 pl-3 text-gray-700 rounded hover:bg-gray-100 md:hover:bg-transparent md:border-0 md:hover:text-blue-700 md:p-0 dark:text-white md:dark:hover:text-white dark:hover:text-blue-700 dark:hover:text-white md:dark:hover:bg-transparent hoverLink">New
                            Trimester</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- find section  -->
    <section class="flex" id="fullArea">
        <div id="buttonContainer">
            <!-- <div>
                <h3 class="text-lg font-semibold">Theory Courses</h3>
            </div> -->
            <div>
                <button type="submit" value="08:30:AM - 10:00:AM" onclick="loadCourse(this.value)">08:30:AM -
                    10:00:AM</button>
            </div>
            <div>
                <button type="submit" value="10:05:AM - 11:35:AM" onclick="loadCourse(this.value)">10:05:AM -
                    11:35:AM</button>
            </div>
            <div>
                <button type="submit" value="11:40:AM - 01:10:PM" onclick="loadCourse(this.value)">11:40:AM -
                    01:10:PM</button>
            </div>
            <div>
                <button type="submit" value="01:31:PM - 03:00:PM" onclick="loadCourse(this.value)">01:31:PM -
                    03:00:PM</button>
            </div>
            <div>
                <button type="" value="03:01:PM - 04:30:PM" onclick="loadCourse(this.value)">03:01:PM -
                    04:30:PM</button>
            </div>
            <!-- <div>
                <h3 class="text-lg font-semibold">Lab Course</h3>
            </div> -->
            <div>
                <button type="" value="08:30:AM - 11:00:AM" onclick="loadCourse(this.value)">08:30:AM -
                    11:00:AM</button>
            </div>
            <div>
                <button type="" value="11:01:AM - 01:30:PM" onclick="loadCourse(this.value)">11:01:AM -
                    01:30:PM</button>
            </div>
            <div>
                <button type="" value="02:00:PM - 04:30:PM" onclick="loadCourse(this.value)">02:00:PM -
                    04:30:PM</button>
            </div>

        </div>
        <div id="showArea">
            <div class="m-8" id="searchDiv">
                <input type="text" placeholder="Search What You Want..." id="searchText">
                <button id="searchBtn" onclick="searchAndLoadCourse()">Search</button>
            </div>
            <div>
                <table class="border-collapse table-fixed w-full text-sm" id="dataTable">
                    <thead class="bg-black">
                        <tr>
                            <th
                                class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-white dark:text-slate-300">
                                Course Code</th>
                            <th id="facultyToggleTitle"
                                class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-white dark:text-slate-300">
                                Title</th>
                            <th
                                class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-white dark:text-slate-300">
                                Section</th>
                            <th
                                class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-white dark:text-slate-300">
                                Time</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white dark:bg-slate-800" id="tableBody">
                        <!-- <tr>
                            <td
                                class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400">
                                The Sliding Mr. Bones Lorem ipsum dolor sit. </td>
                            <td
                                class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400">
                                Malcolm Lockyer</td>
                            <td
                                class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400">
                                1961</td>
                            <td
                                class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400">
                                1961</td>
                        </tr> -->

                    </tbody>
                </table>
            </div>
        </div>
    </section>


    <script>
        const loadCourse = (value) => {
            $.post("AJAX/loadCourse.php",
                {
                    time: value
                },
                function (data, status) {
                    let htmlData = '';
                    if (status == 'success') {
                        const courses = JSON.parse(data);
                        courses.forEach(course => {
                            htmlData += `
                            <tr>
                                <td
                                    class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400 text-center">
                                    ${course['FormalCode']}</td>
                                <td
                                    class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400 text-center">
                                    ${course['Title']}</td>
                                <td
                                    class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400 text-center">
                                    ${course['SectionName']}</td>
                                <td
                                    class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400 text-center">
                                    ${course['Time1']}</td>
                            </tr>
                            `;
                        });
                        document.getElementById("tableBody").innerHTML = htmlData;
                    }

                });

        }

        const searchAndLoadCourse = () => {
            const searchText = document.getElementById("searchText").value;
            if (searchText == '') return;

            // drop with Threshold
            if (searchText.includes('drop')) {

                if (searchText.match(/\d+/g).length == 1) {
                    const dropThreshold = searchText.match(/\d+/g);
                    $.post("AJAX/dropThreashold.php",
                        {
                            dropTh: dropThreshold
                        },
                        function (data, status) {
                            if (data === '[]') return;  // no data empty array string []

                            if (status == 'success') {
                                displayInTable(data);
                                return;
                            }
                        });
                }
                return;
            }
            if (searchText.includes('prev')) {
                const parts = searchText.split('prev ');
                const courseId = parts[1];

                $.post("AJAX/previous.php",
                    {
                        code: courseId
                    },
                    function (data, status) {
                        if (data === '[]') return;  // no data empty array string []

                        if (status == 'success') {
                            displayInTable(data);
                            document.getElementById("facultyToggleTitle").innerText = "Faculty";
                            return;
                        }
                    });
            }

            $.post("AJAX/search.php",
                {
                    code: searchText
                },
                function (data, status) {
                    if (data === '[]') return;  // no data empty array string []

                    let htmlData = '';
                    if (status == 'success') {
                        displayInTable(data);
                        return;
                    }
                });

        }

        const displayInTable = (courses) => {
            // removing the giving warning "Array to string conversion in <b>C:\xampp\htdocs\courseAssigner\pages\AJAX\dropThreashold.php</b> on line <b>3
            if (courses.includes("Array to string conversion in")) {
                const parts = courses.split("</b><br />");
                courses = parts[1];
            }
            courses = JSON.parse(courses);
            let htmlData = '';

            courses.forEach(course => {
                htmlData += `
                            <tr>
                                <td
                                    class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400 text-center">
                                    ${course['FormalCode']}</td>
                                <td
                                    class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400 text-center">
                                    ${course['Title']}</td>
                                <td
                                    class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400 text-center">
                                    ${course['SectionName']}</td>
                                <td
                                    class="border-b border-slate-100 dark:border-slate-700 p-4 pl-8 text-slate-500 dark:text-slate-400 text-center">
                                    ${course['Time1']}</td>
                            </tr>
                            `;
            });
            document.getElementById("tableBody").innerHTML = htmlData;
            document.getElementById("facultyToggleTitle").innerText = "Title";
        }
    </script>
</body>

</html>